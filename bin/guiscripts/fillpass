#!/bin/sh

if [ "colemak" = "$(setxkbmap -query | awk '/^variant:/ {print $2}')" ]
then
    cycleKB
    cycle=1
fi
# assume we are using colemak
pass="$(
	find "${PASSWORD_STORE_DIR:=~/src/password-store/}" -name "*.gpg" |
	sed -e "s@$PASSWORD_STORE_DIR/@@" -e 's/\.gpg$//' |
	commander -x -c)"
[ "$pass" ] || exit 1

login="$(pass show "$pass" | awk '/^login:/ {print $2}')"
password="$(pass show "$pass" | head -n 1)"

if [ "$login" ]
then printf '%s\t%s\n' "$login" "$password" | ydotool type -f -
else printf '%s\n' "$password" | ydotool type -f -
fi

[ "$cycle" ] && cycleKB
