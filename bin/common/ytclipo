#!/bin/sh

# argument ($1) -> clipboard -> stdin
if [ "$WAYLAND_DISPLAY" ]
then paste() { wl-paste; }
elif [ "$TERMUX_VERSION" ]
then paste() { termux-clipboard-get; }
else paste() { xclip -o -sel c; }
fi

inp="$1"
[ "${inp:=$(paste)}" ] || inp="$(cat /dev/stdin)"

# take last link from clipboard
# works when link is from yt-local
inp="https://youtu.be/$(echo "$inp" | sed 's/.*\(.\{11\}\)$/\1/')"
>&2 printf "inp: %s\n" "$inp"
notify-send "ytclipo" "downloading <i>$inp</i>" || :

yt-dlp "$inp" \
	--restrict-filenames \
	--embed-chapters \
	-f "b" \
	-S "res:1080" \
	-P "$HOME/vids/youtube/" \
	-o "%(channel)s - %(title)s.%(ext)s"
notify-send "ytclipo" "finished downloading." || :
