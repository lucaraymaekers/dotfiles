#!/bin/sh

if [ $# -eq 1 ]; then
    selected="$1"
else
	pfx="$HOME/proj" 
	selected="$(find "$pfx" -mindepth 1 -maxdepth 1 -type d | sed "s@$pfx/@@" | fzf)" 
    { [ "$selected" ] && [ -d "$pfx/$selected" ]; } || exit 1
fi

if [ -z "$selected" ]; then
    exit 0
fi

tmux_running="$(pgrep "tmux" | head -n1)"

if [ -z $TMUX ] && [ -z "$tmux_running" ]; then
    tmux new-session -s "$selected" -c "$pfx"/"$selected"
    exit 0
fi

if ! tmux has-session -t="$selected" 2> /dev/null; then
    tmux new-session -ds "$selected" -c "$pfx"/"$selected"
fi

if [ -z $TMUX ]; then
    tmux attach -t "$selected"
else
    tmux switch-client -t "$selected"
fi
