#!/bin/sh

Selected=
if [ $# -eq 1 ]; then
    Selected="$1"
else
	   Selected="$(MENUCMD=fzf prj_select)"
fi

if [ -z "$Selected" ]; then
    exit 0
fi

TmuxRunning="$(pgrep "tmux" | head -n1)"
Session="${Selected##*/}"

if [ -z $TMUX ] && [ -z "$TmuxRunning" ]; then
 tmux new-session -s "$Session" -c "$Selected"
 herbe 1
else

 if ! tmux has-session -t="$Session" 2> /dev/null; then
     tmux new-session -ds "$Session" -c "$Selected"
 fi

 if [ -z $TMUX ]; then
     tmux attach -t "$Session"
 else
     tmux switch-client -t "$Session"
 fi

fi
