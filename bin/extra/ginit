#!/bin/sh

# Create a clone of the current git repository on a remote

# Expects the remote to have a git user 'git@remote.net'

if [ -z "$1" ] ;then
    >&2 printf 'ginit <remote>\n'
    exit 1
fi

git_current_branch () {
	git branch | grep '^$*' | cut -c 3-
}

remote="$1"

for arg in "$@"; do eval "$arg=1"; done 2>/dev/null

name="$(basename "$(git rev-parse --show-toplevel)")"
[ "$name" ] || exit 1

branch="$(git_current_branch)"

ssh "git@$remote" "git init --bare $name.git"

if [ "$post_receive" ]
then
	ssh "git@$remote" "/var/git/install_post_receive.sh $name.git"
fi

git remote add "$remote" "git@$remote":"$name.git"
git push "$remote" "$branch"
