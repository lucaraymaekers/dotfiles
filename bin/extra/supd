#!/bin/sh

usage() { >&2 printf "usage: supd\nusage: supd <prefix> <dir>"; exit 1; }

check ()
{
	for dir in $1
	do
		printf '%s: ' "$2/$dir" | sed "s#$HOME#~#" >&2
		cd "$2/$dir" || continue
		git pull > /dev/null 2>&1 &&
			printf 'Up to date.' ||
			printf 'Couldn'\''t update.'
		printf ' '
		git status --short 2> /dev/null | head -n1 | awk '{print $1 " "}'
		printf '\n'
	done
}

if [ "$#" -eq 0 ]
then
	dirs="installdrier dotfiles password-store"
	prefix="$HOME/src"
else
	prefix="$1"
	shift || usage
	dirs="$*"
	[ "$dirs" ] || usage
fi
check "$dirs" "$prefix"
