#!/usr/bin/env sh
store="${PASSWORD_STORE_DIR:-$HOME/.password-store}"
lscmd="ls --group-directories-first"
if [ "$MENUCMD" = "tofi" ]
then
	menucmd="tofi --prompt pass:"
elif [ "$MENUCMD" = "dmenu" ]
then
	menucmd="dmenu -l 4 -g 2 -i -p pass:" 
else
	menucmd="fzf --prompt pass:"
fi
while [ -d "$store/$file" ]
do
	choice="$($lscmd "$store/$file" | sed 's/\.gpg$//'| $menucmd)"
	[ "$choice" ] || break
	file="$file/$choice"
done

test -z "$file" && exit 1
pass show -c "$file" &&
	if [ -n "$WAYLAND_DISPLAY" ] && cliphist list >/dev/null
then
	cliphist list | head -n 1 | cliphist delete
fi
