#!/usr/bin/env sh
OPTIONS="/tmp/dmh_options.txt"

if [ "$MENUCMD" = "tofi" ]
then
	program="$(tofi-run --prompt-text "program: ")"
	menucmd="tofi --width 50% --height 30% --matching-algorithm normal --prompt-text $program:"
elif [ "$MENUCMD" = "dmenu" ]
then
	program="$(dmenu_path | dmenu -l 4 -g 5 -p "program:")" 
	menucmd="dmenu -l 20 -g 1 -x -i -p $program:" 
else
	program="$(dmenu_path | fzf)"
	menucmd="fzf"
fi

test -z "${program}" && exit 1

if $program --help > "$OPTIONS"
then
    option="$(grep -E "^ *-[-a-Z]* " "$OPTIONS" |
		tr -s ' ' |
		sort |
		uniq |
		column -l 2 -t |
		$menucmd |
		awk '{print $1}')"

test -z "$option" && exit 1

rm -f "$OPTIONS"
setsid $program $option
