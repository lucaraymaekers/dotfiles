#!/usr/bin/env sh

input () { commander -c -i -p "$1"; }

choice="$(printf "multiline\nsingle\n" | commander -c -d)"
[ "$choice" ] || exit 1

password="$(input "name:")"
[ "$password" ] || exit 1

if [ "$choice" = "multiline" ]
then
	login="$(find "${PASSWORD_STORE_DIR:=$HOME/.password-store}"/e-mails -type f -maxdepth 1 -iname "*.gpg" -printf "%f\n" |
		sed 's/\.gpg$//' | commander -c -d -p 'login:')"
    [ "$login" ] || exit 1
    url="$(input "url:")"
    [ "$url" ] || exit 1
    printf "%s\nlogin: %s\nurl: %s\n" "${password}" "${login}" "${url}" |
		pass insert -mf "${password}"
    pass generate -ci "${password}"
else
    pass generate -cf "${password}"
fi
